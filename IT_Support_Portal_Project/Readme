üöÄ Portal de Suporte em TI com Nextcloud
Este reposit√≥rio cont√©m um guia t√©cnico passo a passo para configurar um Portal de Suporte em TI interno/externo utilizando o Nextcloud. O objetivo √© centralizar instaladores, scripts, documenta√ß√£o e outros recursos essenciais, proporcionando acesso seguro e eficiente para a equipe de TI e usu√°rios autorizados.

üìã Sum√°rio
1. Sobre o Projeto

2. Pr√©-requisitos

3. Fase 1: Instala√ß√£o Inicial do Servidor e Nextcloud

3.1. Atualizar o Sistema e Instalar Ferramentas Essenciais

3.2. Instalar Apache Web Server

3.3. Instalar MariaDB Database Server

3.4. Instalar PHP e M√≥dulos Necess√°rios

3.5. Criar o Banco de Dados para Nextcloud

3.6. Baixar e Instalar o Nextcloud

3.7. Configurar Virtual Host do Apache para Nextcloud

3.8. Concluir a Configura√ß√£o do Nextcloud (Via Web)

4. Fase 2: Configura√ß√£o SSL com Let's Encrypt

4.1. Instalar Certbot

4.2. Obter e Configurar Certificado SSL

5. Fase 3: Organiza√ß√£o da Estrutura de Pastas no Nextcloud

6. Fase 4: Autentica√ß√£o e Permiss√µes (Integra√ß√£o LDAP/Active Directory)

6.1. Instalar o Aplicativo LDAP/AD no Nextcloud

6.2. Configurar o LDAP/AD no Nextcloud

6.3. Gerenciar Permiss√µes de Acesso √†s Pastas

7. Fase 5: Seguran√ßa Adicional e Configura√ß√µes Recomendadas

7.1. Autentica√ß√£o de Dois Fatores (2FA)

7.2. Logs de Auditoria

7.3. Backup Di√°rio

7.4. Snapshots Semanais do Servidor

7.5. Fail2Ban contra For√ßa Bruta

8. Fase 6 (Opcional): Habilitar Aplicativos Extras do Nextcloud

9. Benef√≠cios Esperados

10. Recomenda√ß√µes Pr√°ticas

1. Sobre o Projeto
Este guia detalha o processo de implanta√ß√£o de um Portal de Suporte em TI usando Nextcloud em um servidor Linux (Ubuntu/Debian). O portal tem como objetivo principal centralizar e facilitar o acesso a:

üìÇ Instaladores e softwares: Antiv√≠rus, AnyDesk, drivers, pacotes.

üñ• Scripts de automa√ß√£o: PowerShell, BAT, Bash.

üìò Documenta√ß√£o de suporte: Manuais, tutoriais, pol√≠ticas.

üîç Busca r√°pida de arquivos e informa√ß√µes.

‚úÖ Controle de acesso seguro para equipe de TI e usu√°rios autorizados.

2. Pr√©-requisitos
Antes de iniciar a configura√ß√£o, certifique-se de ter os seguintes requisitos:

Sistema Operacional: Um servidor com Ubuntu Server LTS (vers√£o 20.04 ou superior) ou Debian (vers√£o 11 ou superior) instalado.

Acesso SSH: Acesso SSH ao servidor com um usu√°rio que possua privil√©gios sudo.

Nome de Dom√≠nio: Um nome de dom√≠nio registrado (ex: suporte.suaempresa.com.br) e apontado para o IP p√∫blico do seu servidor. Isso √© fundamental para a configura√ß√£o do SSL com Let's Encrypt e para acesso externo seguro.

Portas de Rede: Portas 80 (HTTP) e 443 (HTTPS) abertas no firewall do servidor e, se aplic√°vel, na sua rede para acesso p√∫blico.

3. Fase 1: Instala√ß√£o Inicial do Servidor e Nextcloud
Esta fase abrange a prepara√ß√£o do ambiente Linux e a instala√ß√£o dos componentes essenciais para o Nextcloud.

3.1. Atualizar o Sistema e Instalar Ferramentas Essenciais
Conecte-se ao seu servidor via SSH e execute os comandos para atualizar o sistema e instalar ferramentas b√°sicas:

sudo apt update && sudo apt upgrade -y
sudo apt install -y curl wget unzip nano vim

3.2. Instalar Apache Web Server
Instale o servidor web Apache e garanta que ele inicie automaticamente com o sistema:

sudo apt install -y apache2
sudo systemctl enable apache2
sudo systemctl start apache2

Verifique o status do Apache para confirmar que est√° active (running):

sudo systemctl status apache2

3.3. Instalar MariaDB Database Server
Instale o MariaDB, o sistema de banco de dados que o Nextcloud utilizar√°, e execute o script de seguran√ßa para proteger a instala√ß√£o. Defina uma senha forte para o usu√°rio root do MariaDB e responda Y para as outras perguntas durante o mysql_secure_installation.

sudo apt install -y mariadb-server mariadb-client
sudo systemctl enable mariadb
sudo systemctl start mariadb
sudo mysql_secure_installation

3.4. Instalar PHP e M√≥dulos Necess√°rios
O Nextcloud exige PHP e v√°rios m√≥dulos. Para PHP 8.1, utilize os seguintes comandos:

sudo apt install -y php8.1 libapache2-mod-php8.1 php8.1-gd php8.1-mysql php8.1-curl php8.1-mbstring php8.1-intl php8.1-zip php8.1-xml php8.1-bz2 php8.1-imagick php8.1-gmp php8.1-bcmath php8.1-fpm php8.1-common php-common php8.1-cli

Importante: Se optar por Nginx em vez de Apache, voc√™ usaria php8.1-fpm em vez de libapache2-mod-php8.1 e precisaria configurar o Nginx para usar o PHP-FPM.

Ajuste as configura√ß√µes do PHP para otimizar o Nextcloud. Edite o arquivo /etc/php/8.1/apache2/php.ini:

sudo nano /etc/php/8.1/apache2/php.ini

Procure e altere as seguintes linhas (remova o ; no in√≠cio se estiverem comentadas):

memory_limit = 512M
upload_max_filesize = 10G       ; Ajuste conforme sua necessidade, 10GB √© um exemplo.
post_max_size = 10G             ; Deve ser igual ou maior que upload_max_filesize.
max_execution_time = 360
max_input_time = 360
date.timezone = America/Sao_Paulo ; Ajuste para seu fuso hor√°rio

Salve as altera√ß√µes (Ctrl+O, Enter) e saia (Ctrl+X). Em seguida, reinicie o Apache:

sudo systemctl restart apache2

3.5. Criar o Banco de Dados para Nextcloud
Acesse o console do MariaDB como root (insira a senha que voc√™ definiu na instala√ß√£o) e crie o banco de dados e um usu√°rio dedicado para o Nextcloud:

sudo mysql -u root -p
```sql
CREATE DATABASE nextcloud CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
CREATE USER 'nextclouduser'@'localhost' IDENTIFIED BY 'sua_senha_segura'; -- Troque 'sua_senha_segura' por uma senha forte
GRANT ALL PRIVILEGES ON nextcloud.* TO 'nextclouduser'@'localhost';
FLUSH PRIVILEGES;
EXIT;

3.6. Baixar e Instalar o Nextcloud
Baixe a vers√£o mais recente do Nextcloud e defina as permiss√µes corretas para o diret√≥rio. Verifique a p√°gina de download do Nextcloud para a vers√£o mais atual: https://nextcloud.com/install/#instructions-server

wget [https://download.nextcloud.com/server/releases/nextcloud-29.0.2.zip](https://download.nextcloud.com/server/releases/nextcloud-29.0.2.zip) # Ajuste a vers√£o conforme necess√°rio
sudo unzip nextcloud-29.0.2.zip -d /var/www/
sudo mv /var/www/nextcloud /var/www/html/nextcloud # Mova para o diret√≥rio padr√£o do Apache

Defina as permiss√µes de arquivo e propriedade para que o Apache possa acessar e modificar os arquivos do Nextcloud:

sudo chown -R www-data:www-data /var/www/html/nextcloud/
sudo chmod -R 755 /var/www/html/nextcloud/

3.7. Configurar Virtual Host do Apache para Nextcloud
Crie um arquivo de configura√ß√£o de Virtual Host para o Nextcloud no Apache. Substitua suporte.suaempresa.com.br pelo seu dom√≠nio:

sudo nano /etc/apache2/sites-available/nextcloud.conf

Adicione o seguinte conte√∫do:

<VirtualHost *:80>
    ServerAdmin webmaster@localhost
    DocumentRoot /var/www/html/nextcloud
    ServerName suporte.suaempresa.com.br

    <Directory /var/www/html/nextcloud/>
        Require all granted
        AllowOverride All
        Options FollowSymlinks MultiViews

        <IfModule mod_dav.c>
            Dav off
        </IfModule>
    </Directory>

    ErrorLog ${APACHE_LOG_DIR}/nextcloud_error.log
    CustomLog ${APACHE_LOG_DIR}/nextcloud_access.log combined

</VirtualHost>

Habilite o site e os m√≥dulos necess√°rios do Apache e reinicie o servi√ßo:

sudo a2ensite nextcloud.conf
sudo a2enmod rewrite dir headers env mime
sudo systemctl restart apache2

3.8. Concluir a Configura√ß√£o do Nextcloud (Via Web)
Agora, abra seu navegador e acesse http://suporte.suaempresa.com.br.

Voc√™ ser√° direcionado para a p√°gina de configura√ß√£o inicial do Nextcloud:

Criar conta de administrador: Defina um nome de usu√°rio e uma senha fortes para o administrador do Nextcloud.

Configura√ß√£o do banco de dados:

Usu√°rio do banco de dados: nextclouduser

Senha do banco de dados: sua_senha_segura (a que voc√™ definiu anteriormente)

Nome do banco de dados: nextcloud

Host do banco de dados: localhost

Clique em "Instalar".

Aguarde a conclus√£o da instala√ß√£o. Voc√™ ser√° redirecionado para a interface do Nextcloud.

4. Fase 2: Configura√ß√£o SSL com Let's Encrypt
√â fundamental que seu portal use HTTPS para garantir a seguran√ßa dos dados.

4.1. Instalar Certbot
Instale o Certbot e o plugin para Apache, que automatizar√° a obten√ß√£o e configura√ß√£o do certificado SSL:

sudo apt install -y certbot python3-certbot-apache

4.2. Obter e Configurar Certificado SSL
Execute o Certbot para o seu dom√≠nio (substitua suporte.suaempresa.com.br pelo seu dom√≠nio real):

sudo certbot --apache -d suporte.suaempresa.com.br

Siga as instru√ß√µes na tela:

Digite seu endere√ßo de e-mail.

Aceite os termos de servi√ßo.

Decida se deseja redirecionar o tr√°fego HTTP para HTTPS (recomenda-se 2 - Redirect para seguran√ßa).

O Certbot configurar√° automaticamente o Apache para usar HTTPS e criar√° uma entrada para renova√ß√£o autom√°tica do certificado.

5. Fase 3: Organiza√ß√£o da Estrutura de Pastas no Nextcloud
Uma estrutura de pastas bem organizada √© crucial para a efici√™ncia do portal de suporte. Dentro da interface web do Nextcloud, como administrador, crie a seguinte estrutura:

Acesse o √≠cone de "Arquivos" no menu superior.

Crie uma nova pasta chamada Portal-Suporte.

Dentro de Portal-Suporte, crie as subpastas:

Instaladores

SophosSetup.exe

AnyDesk.msi

ChromeEnterprise.msi

Drivers

HP

Dell

Canon

Scripts

resetar_senha.bat

instalar_printer.ps1

Documentacao

guia_vpn.pdf

checklist_suporte.docx

politicas_ti.pdf

Templates

modelo_relatorio_incidente.docx

modelo_checklist.xlsx

Agora voc√™ pode come√ßar a fazer upload dos seus arquivos para as pastas correspondentes.

6. Fase 4: Autentica√ß√£o e Permiss√µes (Integra√ß√£o LDAP/Active Directory)
A integra√ß√£o com seu diret√≥rio de usu√°rios existente (Active Directory ou LDAP) centraliza a autentica√ß√£o e simplifica o gerenciamento de permiss√µes.

6.1. Instalar o Aplicativo LDAP/AD no Nextcloud
Como administrador, clique no √≠cone do usu√°rio no canto superior direito e v√° em "Aplicativos".

Na barra lateral esquerda, selecione "Produtividade" ou use a barra de pesquisa para encontrar "User authentication via LDAP and Active Directory".

Clique em "Ativar".

6.2. Configurar o LDAP/AD no Nextcloud
Ap√≥s ativar, clique novamente no √≠cone do usu√°rio e v√° em "Configura√ß√µes".

Na barra lateral esquerda, clique em "LDAP/AD integration".

Preencha as informa√ß√µes do seu servidor Active Directory/LDAP nas abas correspondentes:

Aba "Servidor":

Host: ldap://seu_controlador_de_dominio.com ou ldaps://seu_controlador_de_dominio.com (use LDAPS se poss√≠vel, porta 636)

Porta: 389 (LDAP) ou 636 (LDAPS)

Base DN: DC=seu_dominio,DC=com (ex: DC=suaempresa,DC=com,DC=br)

DN do usu√°rio bind: CN=UsuarioBind,OU=Usuarios,DC=seu_dominio,DC=com (um usu√°rio com permiss√µes de leitura no AD/LDAP)

Senha do usu√°rio bind: senha_do_usuario_bind (a senha do usu√°rio bind)

Aba "Usu√°rios":

Filtro de usu√°rio: Defina um filtro para quais usu√°rios do AD/LDAP ser√£o vis√≠veis no Nextcloud. Exemplo: (&(objectClass=user)(memberOf=CN=GrupoUsuariosNextcloud,OU=Grupos,DC=seu_dominio,DC=com))

Atributo de login: samaccountname (comum para Active Directory)

Aba "Grupos":

Filtro de grupo: Defina quais grupos do AD/LDAP ser√£o vis√≠veis. Exemplo: (objectClass=group)

Mapeamento de grupos: Voc√™ pode mapear grupos espec√≠ficos do AD/LDAP para grupos internos do Nextcloud para gerenciar permiss√µes de forma mais f√°cil.

Use o bot√£o "Testar configura√ß√£o" para verificar se as credenciais e filtros est√£o corretos.

Quando estiver satisfeito, clique em "Salvar".

6.3. Gerenciar Permiss√µes de Acesso √†s Pastas
No Nextcloud, como administrador, navegue at√© a pasta Portal-Suporte:

Passe o mouse sobre a pasta Portal-Suporte e clique no √≠cone de "Compartilhar".

Comece a digitar o nome dos grupos LDAP (ex: "TI", "Usu√°rios Finais") que voc√™ deseja conceder acesso.

Para o grupo "TI" (ou similar):

Conceda permiss√µes de Cria√ß√£o, Edi√ß√£o e Exclus√£o.

Para o grupo "Usu√°rios Finais" (ou similar):

Conceda apenas permiss√µes de Leitura (Baixar).

7. Fase 5: Seguran√ßa Adicional e Configura√ß√µes Recomendadas
Refor√ßar a seguran√ßa do seu portal √© uma prioridade cont√≠nua.

7.1. Autentica√ß√£o de Dois Fatores (2FA)
Habilite e incentive o uso do 2FA para a equipe de TI:

No Nextcloud, como administrador, v√° em "Aplicativos".

Pesquise por "Two-Factor Authentication" e ative os m√©todos que voc√™ deseja oferecer (ex: TOTP, WebAuthn).

Os usu√°rios da equipe de TI devem ir em suas "Configura√ß√µes" de perfil para configurar e ativar o 2FA.

7.2. Logs de Auditoria
O Nextcloud registra eventos de atividade. Monitore-os regularmente:

No Nextcloud, como administrador, v√° em "Configura√ß√µes".

Na barra lateral, em "Administra√ß√£o", clique em "Registro".

Voc√™ poder√° visualizar os logs de atividades, incluindo uploads, downloads, exclus√µes e altera√ß√µes de arquivos.

7.3. Backup Di√°rio
Configure backups di√°rios para arquivos e banco de dados. Adapte os caminhos para o seu ambiente e automatize com um cron job.

Backup de Arquivos do Nextcloud:

sudo rsync -Aax /var/www/html/nextcloud/ /path/to/backup/nextcloud_files_$(date +%Y%m%d)/

Backup do Banco de Dados MariaDB:

sudo mysqldump -u nextclouduser -p'sua_senha_segura' nextcloud > /path/to/backup/nextcloud_db_$(date +%Y%m%d).sql

Importante: Substitua nextcloud_senha_segura pela senha real do usu√°rio do banco de dados Nextcloud.

7.4. Snapshots Semanais do Servidor
Se o seu servidor for uma M√°quina Virtual (VM) ou estiver hospedado em um provedor de nuvem, utilize os recursos da plataforma para criar snapshots semanais. Isso permite uma recupera√ß√£o r√°pida do estado do servidor em caso de falhas cr√≠ticas.

7.5. Fail2Ban contra For√ßa Bruta
Instale e configure o Fail2Ban para proteger o SSH e o Apache/Nginx contra ataques de for√ßa bruta, bloqueando IPs maliciosos.

sudo apt install -y fail2ban
sudo cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local

Edite o arquivo jail.local para configurar as jails para Apache, se necess√°rio (a de SSH geralmente j√° vem habilitada):

sudo nano /etc/fail2ban/jail.local

Certifique-se de que [sshd] esteja habilitado (normalmente est√° por padr√£o). Para Apache, adicione se√ß√µes como esta:

[apache-badbots]
enabled = true
port    = http,https
logpath = /var/log/apache2/access.log
bantime = 43200 ; 12 horas
maxretry = 3

[apache-noscript]
enabled = true
port = http,https
logpath = /var/log/apache2/error.log
bantime = 43200
maxretry = 3

Reinicie o Fail2Ban para aplicar as altera√ß√µes:

sudo systemctl restart fail2ban

8. Fase 6 (Opcional): Habilitar Aplicativos Extras do Nextcloud
Expanda as funcionalidades do seu portal ativando aplicativos adicionais do Nextcloud, dispon√≠veis na se√ß√£o "Aplicativos" da interface de administra√ß√£o:

OnlyOffice/Collabora: Para edi√ß√£o de documentos online (DOCX, XLSX, PPTX) diretamente no navegador, permitindo colabora√ß√£o em tempo real. Pode exigir um servidor OnlyOffice ou Collabora separado ou o uso de uma vers√£o comunit√°ria.

Wiki (Collectives): Crie uma base de conhecimento integrada para documentar procedimentos, pol√≠ticas e tutoriais de forma colaborativa e organizada.

Flow Automations: Automatize tarefas e fluxos de trabalho, como o envio de alertas autom√°ticos quando um novo instalador √© adicionado ou atualizado em uma pasta espec√≠fica.

9. Benef√≠cios Esperados
Ao implementar este Portal de Suporte em TI, sua organiza√ß√£o pode esperar os seguintes benef√≠cios:

‚úÖ Centraliza√ß√£o do suporte: Um √∫nico portal para todos os recursos e informa√ß√µes de TI.

‚úÖ Acesso r√°pido: Facilidade para encontrar instaladores, drivers e tutoriais.

‚úÖ Seguran√ßa corporativa: Controle de usu√°rios e logs de auditoria garantem a integridade dos dados.

‚úÖ Redu√ß√£o de tempo: Menos tempo gasto em tarefas repetitivas de suporte.

‚úÖ Base de conhecimento compartilhada: Informa√ß√µes sempre atualizadas e acess√≠veis para toda a equipe.

10. Recomenda√ß√µes Pr√°ticas
Integra√ß√£o com AD/LDAP: Se a empresa j√° possui um Active Directory ou servidor LDAP, a integra√ß√£o com o Nextcloud √© a abordagem mais recomendada para gest√£o de usu√°rios e permiss√µes.

Autentica√ß√£o Local com 2FA: Caso n√£o haja um AD/LDAP, utilize a autentica√ß√£o local do Nextcloud com 2FA para garantir a seguran√ßa inicial.

Evolu√ß√£o para GLPI: Considere integrar o Nextcloud com uma ferramenta de gerenciamento de chamados como o GLPI para criar um ecossistema de TI completo, conectando a gest√£o de arquivos √† gest√£o de tickets.

ü§ù Contribui√ß√£o
Sinta-se √† vontade para sugerir melhorias ou contribuir com este guia.

üìÑ Licen√ßa
Este projeto est√° licenciado sob a licen√ßa [Nome da Licen√ßa, ex: MIT License] - veja o arquivo LICENSE para detalhes.
